#!/bin/bash

# File: /usr/local/bin/aitalk

# Path to your Python script
AITALK_PATH="$HOME/Desktop/linuxProjectAItalk/aitalk.py"

if [[ "$1" == "--create-project" ]]; then
    shift
    "$AITALK_PATH" --create-project "$@"

elif [[ "$1" == --explain-* ]]; then
    "$AITALK_PATH" "$1"

elif [[ "$1" == "--summarise" ]]; then
    PROMPT="$2"
    FILE="$3"

    if [[ ! -f "$FILE" ]]; then
        echo "‚ùå File not found: $FILE"
        exit 1
    fi

    # Generate a temporary script to run in new terminal
    AI_SCRIPT=$(mktemp /tmp/ai-run.XXXXXX.sh)

    cat <<EOF > "$AI_SCRIPT"
#!/bin/bash
echo "üß† AI is processing your request..."
echo "Prompt: $PROMPT"
echo ""
echo "---- Summary Below ----"

ollama run llama3 "Summarize this file based on the following instruction: '$PROMPT' \n\nFile content:\n$(cat "$FILE")"

echo "------------------------"
read -n 1 -s -r -p "Press any key to close this window"
EOF

    chmod +x "$AI_SCRIPT"

    # Open in new macOS terminal window
    osascript <<END
tell application "Terminal"
    do script "$AI_SCRIPT"
    activate
end tell
END

else
    echo "Usage:"
    echo "  aitalk --create-project \"make a react app\""
    echo "  aitalk --explain-5"
    echo "  aitalk --summarise \"summarise this file\" file.txt"
fi
